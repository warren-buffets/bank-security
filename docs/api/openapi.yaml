openapi: 3.0.3
info:
  title: Antifraud API
  version: 0.1.0
  description: Real-time fraud detection engine for card payments
  contact:
    name: Security Team
    email: security@bank.com
servers:
- url: http://localhost:8000
  description: Development
- url: https://api.antifraud.bank.com
  description: Production
paths:
  /v1/score:
    post:
      operationId: scoreEvent
      summary: Score a transaction event
      description: Evaluates a card payment transaction and returns a fraud decision
      requestBody:
        required: true
        content:
          application/json:
            schema:
              ref: '#/components/schemas/ScoreRequest'
      responses:
        '200':
          description: Decision returned successfully
          content:
            application/json:
              schema:
                ref: '#/components/schemas/ScoreResponse'
        '400':
          description: Invalid request
        '429':
          description: Rate limit exceeded
        '500':
          description: Internal server error
  /health:
    get:
      operationId: healthCheck
      summary: Health check
      responses:
        '200':
          description: Service is healthy
components:
  schemas:
    ScoreRequest:
      type: object
      required:
      - tenant_id
      - idempotency_key
      - event
      properties:
        tenant_id:
          type: string
          description: Multi-tenant identifier
        idempotency_key:
          type: string
          description: Unique key for idempotent request (24h TTL)
        event:
          ref: '#/components/schemas/TransactionEvent'
    TransactionEvent:
      type: object
      required:
      - type
      - id
      - ts
      - amount
      - currency
      - merchant
      - card
      - context
      properties:
        type:
          type: string
          enum:
          - card_payment
          description: Event type
        id:
          type: string
          description: Unique transaction ID
        ts:
          type: string
          format: date-time
          description: Transaction timestamp (ISO 8601)
        amount:
          type: number
          minimum: 0
          description: Transaction amount
        currency:
          type: string
          pattern: ^[A-Z]{3}$
          description: ISO 4217 currency code
        merchant:
          ref: '#/components/schemas/Merchant'
        card:
          ref: '#/components/schemas/Card'
        context:
          ref: '#/components/schemas/Context'
        security:
          ref: '#/components/schemas/Security'
        kyc:
          ref: '#/components/schemas/KYC'
    Merchant:
      type: object
      required:
      - id
      - mcc
      - country
      properties:
        id:
          type: string
        name:
          type: string
        mcc:
          type: string
          pattern: ^[0-9]{4}$
          description: Merchant Category Code
        country:
          type: string
          pattern: ^[A-Z]{2}$
          description: ISO 3166-1 alpha-2 country code
    Card:
      type: object
      required:
      - card_id
      - type
      - user_id
      properties:
        card_id:
          type: string
          description: Tokenized card identifier
        type:
          type: string
          enum:
          - physical
          - virtual
        user_id:
          type: string
          description: User identifier
    Context:
      type: object
      required:
      - channel
      properties:
        ip:
          type: string
          format: ipv4
          description: Client IP address (hashed in logs)
        geo:
          type: string
          pattern: ^[A-Z]{2}$
          description: ISO 3166-1 alpha-2 country code
        device_id:
          type: string
          description: Device fingerprint (hashed)
        channel:
          type: string
          enum:
          - app
          - web
          - pos
          - atm
    Security:
      type: object
      properties:
        auth_method:
          type: string
          enum:
          - 3ds
          - pin
          - biometric
          - none
        aml_flag:
          type: boolean
          description: AML risk flag from external system
    KYC:
      type: object
      properties:
        status:
          type: string
          enum:
          - verified
          - pending
          - unverified
        level:
          type: string
          enum:
          - basic
          - standard
          - enhanced
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: KYC confidence score
    ScoreResponse:
      type: object
      required:
      - decision_id
      - decision
      - latency_ms
      - model_version
      properties:
        decision_id:
          type: string
          description: Unique decision identifier (for audit)
        decision:
          type: string
          enum:
          - ALLOW
          - CHALLENGE
          - DENY
          description: Final decision
        score:
          type: number
          minimum: 0
          maximum: 1
          description: Fraud probability score (ML model output)
        rule_hits:
          type: array
          items:
            type: string
          description: List of triggered rule IDs
        reasons:
          type: array
          items:
            type: string
          description: Human-readable reasons for decision
        latency_ms:
          type: integer
          description: Processing latency in milliseconds
        model_version:
          type: string
          description: ML model version used
        sla:
          ref: '#/components/schemas/SLA'
    SLA:
      type: object
      properties:
        p95_budget_ms:
          type: integer
          description: 'P95 latency budget (target: 100ms)'
